#!/bin/sh

cargo -q run test \
  --code cHViIGZuIGhlbGxvX3dvcmxkKCkgewogICAgcHJpbnRsbiEoIkhlbGxvLCB3b3JsZCEiKQp9Cg== \
  --tests I1tjZmcodGVzdCldCgptb2QgdGVzdHMgewogICAgdXNlIHByaW50aW5nX2hlbGxvX3dvcmxkOjoqOwogICAgdXNlIHN5bnRlc3Q6OlN5bnRlc3Q7CgogICAgI1t0ZXN0XQogICAgZm4gdGVzdF9jb21waWxlcygpIHsKICAgICAgICBoZWxsb193b3JsZCgpOwogICAgfQoKICAgICNbdGVzdF0KICAgIGZuIHRlc3RfaGVsbG9fd29ybGQoKSB7CiAgICAgICAgbGV0IHN5bnRlc3QgPSBTeW50ZXN0OjpuZXcoImhlbGxvX3dvcmxkIiwgInNyYy9saWIucnMiKTsKICAgICAgICBsZXQgbWFjcm9zID0gc3ludGVzdC5tYWMubWFjcm9zKCk7CgogICAgICAgIGFzc2VydF9lcSEoCiAgICAgICAgICAgIG1hY3Jvcy5sZW4oKSwKICAgICAgICAgICAgMSwKICAgICAgICAgICAgIkV4cGVjdGVkIHRvIHByaW50IHRvIHRoZSBjb25zb2xlIG9ubHkgb25jZSwgYnV0IHt9IG1hY3JvcyB1c2VkIiwKICAgICAgICAgICAgbWFjcm9zLmxlbigpCiAgICAgICAgKTsKCiAgICAgICAgbGV0IG1hYyA9ICZtYWNyb3NbMF07CgogICAgICAgIGFzc2VydF9lcSEobWFjLm5hbWUsICJwcmludGxuIiwgIkV4cGVjdGVkIHRvIHVzZSBwcmludGxuIG1hY3JvIik7CgogICAgICAgIGZvciB0b2tlbiBpbiBtYWMudG9rZW5zLml0ZXIoKSB7CiAgICAgICAgICAgIGxldCB0b2tlbiA9IHRva2VuLnRvX2xvd2VyY2FzZSgpOwogICAgICAgICAgICBhc3NlcnRfZXEhKAogICAgICAgICAgICAgICAgKHRva2VuLmNvbnRhaW5zKCJoZWxsbyIpLCB0b2tlbi5jb250YWlucygid29ybGQiKSksCiAgICAgICAgICAgICAgICAodHJ1ZSwgdHJ1ZSksCiAgICAgICAgICAgICAgICAiRXhwZWN0ZWQgdG8gcHJpbnQgJ0hlbGxvLCB3b3JsZCEnIHRvIHRoZSBjb25zb2xlLiIKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9Cn0K \
  --cargo-toml W3BhY2thZ2VdCm5hbWUgPSAicHJpbnRpbmctaGVsbG8td29ybGQiCnZlcnNpb24gPSAiMC4xLjAiCmVkaXRpb24gPSAiMjAyMSIKCltkZXYtZGVwZW5kZW5jaWVzXQpzeW50ZXN0ID0geyBwYXRoID0gIi4uLy4uL2NyYXRlcy9zeW50ZXN0IiB9Cg== \
  -n 10
